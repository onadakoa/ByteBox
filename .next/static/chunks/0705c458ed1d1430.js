(globalThis.TURBOPACK=globalThis.TURBOPACK||[]).push(["object"==typeof document?document.currentScript:void 0,{70601:e=>{var{g:t,__dirname:a}=e;e.v({className:"poppins_9ac3ec3-module__ogIsha__className"})},15614:e=>{"use strict";var{g:t,__dirname:a}=e;{e.s({default:()=>a});var r=e.i(70601);let t={className:r.default.className,style:{fontFamily:"'Poppins', sans-serif",fontStyle:"normal"}};null!=r.default.variable&&(t.variable=r.default.variable);let a=t}},37234:e=>{var{g:t,__dirname:a}=e;e.v({className:"roboto_d5b2c989-module__7PeVaG__className"})},27660:e=>{"use strict";var{g:t,__dirname:a}=e;{e.s({default:()=>a});var r=e.i(37234);let t={className:r.default.className,style:{fontFamily:"'Roboto', sans-serif",fontStyle:"normal"}};null!=r.default.variable&&(t.variable=r.default.variable);let a=t}},63836:e=>{"use strict";var{g:t,__dirname:a}=e;e.s({}),e.i(15614),e.i(27660)},15141:e=>{"use strict";var{g:t,__dirname:a}=e;e.s({}),e.i(15614),e.i(27660),e.i(63836)},27844:e=>{"use strict";var{g:t,__dirname:a}=e;e.s({poppins:()=>r.default});var r=e.i(15614)},92197:e=>{"use strict";var{g:t,__dirname:a}=e;e.s({mutate:()=>r.j});var r=e.i(37784)},82069:e=>{"use strict";var{g:t,__dirname:a}=e;{e.s({Product:()=>t});var r=e.i(27426),i=e.i(45622);class t{product_id=0;attachment_id=null;category_id=null;author_id=0;name="";description="";price=0;stock=0;fill(e){Object.assign(this,e)}static getFilled(e){let a=new t;return a.fill(e),a}getCategory(){return this.category_id?r.Category.getById(this.category_id):null}fetchAttachment(){return this.attachment_id?i.Attachment.fetchById(this.attachment_id):null}}}},27426:e=>{"use strict";var{g:t,__dirname:a}=e;{e.s({Category:()=>t});var r=e.i(39563);class t{alias=[];id=0;name="";fill(e){Object.assign(this,e)}static getFilled(e){let a=new t;return a.fill(e),a}static async getById(e){let a=await fetch("/api/categories/index.php?id="+e),i=null;try{i=await a.json()}catch(e){console.error(`Category ERROR: ${e}`)}if(!a.ok)throw console.error(`Category ERROR: ${i}`),new r.JsonError(a.status,i);return t.getFilled(i?.d)}}}},82653:function(e){var{g:t,__dirname:a,m:r,e:i}=e;{e.i(22271);"use strict";Object.defineProperty(i,"__esModule",{value:!0});var l={default:function(){return c},getImageProps:function(){return d}};for(var s in l)Object.defineProperty(i,s,{enumerable:!0,get:l[s]});let t=e.r(13314),a=e.r(61311),r=e.r(11772),o=t._(e.r(55836));function d(e){let{props:t}=(0,a.getImgProps)(e,{defaultLoader:o.default,imgConf:JSON.parse('{"deviceSizes":[640,750,828,1080,1200,1920,2048,3840],"imageSizes":[16,32,48,64,96,128,256,384],"path":"/_next/image","loader":"default","dangerouslyAllowSVG":false,"unoptimized":true}')});for(let[e,a]of Object.entries(t))void 0===a&&delete t[e];return{props:t}}let c=r.Image}},12568:function(e){var{g:t,__dirname:a,m:r,e:i}=e;r.exports=e.r(82653)},45622:e=>{"use strict";var{g:t,__dirname:a}=e;{e.s({ApiImage:()=>a,Attachment:()=>t});var r=e.i(39563);class t{attachment_id=0;author_id=0;creation_date=0;images=[];fill(e){Object.assign(this,e)}getImages(){return this.images.map(e=>a.getFilled(e))}static getFilled(e){let a=new t;return a.fill(e),a}static async fetchById(e){try{let a=await fetch("/api/attachments/index.php?id="+e),i=await a.json();if(!a.ok)throw new r.JsonError(a.status,i);return t.getFilled(i?.d)}catch(e){throw console.error(`Attachment ERROR: ${e}`),e}}}class a{id=0;size=0;type="";fill(e){Object.assign(this,e)}static getFilled(e){let t=new a;return t.fill(e),t}getURL(){return"/api/attachments/image.php?id="+this.id}}}},5085:e=>{var{g:t,__dirname:a}=e;e.v({container:"Card-module__pmewmq__container"})},2512:e=>{"use strict";var{g:t,__dirname:a}=e;e.s({Card:()=>l});var r=e.i(31636),i=e.i(5085);function l(e){let t={padding:e.padding};return(0,r.jsx)("div",{className:i.default.container,style:t,children:e.children})}},83527:e=>{var{g:t,__dirname:a}=e;e.v({container:"ProductEditor-module__nEkUua__container",error:"ProductEditor-module__nEkUua__error",fileInput:"ProductEditor-module__nEkUua__fileInput",fileInputContainer:"ProductEditor-module__nEkUua__fileInputContainer",form:"ProductEditor-module__nEkUua__form",formGroup:"ProductEditor-module__nEkUua__formGroup",helperText:"ProductEditor-module__nEkUua__helperText",imagePreview:"ProductEditor-module__nEkUua__imagePreview",imagePreviewGrid:"ProductEditor-module__nEkUua__imagePreviewGrid",imageSelector:"ProductEditor-module__nEkUua__imageSelector",input:"ProductEditor-module__nEkUua__input",label:"ProductEditor-module__nEkUua__label",message:"ProductEditor-module__nEkUua__message",placeholderImage:"ProductEditor-module__nEkUua__placeholderImage",select:"ProductEditor-module__nEkUua__select",submitButton:"ProductEditor-module__nEkUua__submitButton",textarea:"ProductEditor-module__nEkUua__textarea",title:"ProductEditor-module__nEkUua__title"})},15070:e=>{"use strict";var{g:t,__dirname:a}=e;e.s({default:()=>p});var r=e.i(31636),i=e.i(38653),l=e.i(2512);e.i(15141);var s=e.i(27844),d=e.i(83527),o=e.i(12568),c=e.i(55366),n=e.i(82069),u=e.i(81952),m=e.i(92197);function p(){let e=(0,c.useSearchParams)().get("id"),[t,a]=(0,i.useState)(e?"edit":"create"),{user:p}=(0,u.default)(),[f,h]=(0,i.useState)(""),[g,_]=(0,i.useState)(""),[v,y]=(0,i.useState)(""),[E,x]=(0,i.useState)(null),[j,P]=(0,i.useState)([]),[b,w]=(0,i.useState)(!1),[N,S]=(0,i.useState)(""),[k,U]=(0,i.useState)([]),[F,I]=(0,i.useState)([]);(0,i.useEffect)(()=>{"edit"==t&&(async()=>{w(!0);let t=await fetch("/api/products/index.php?id="+e,{credentials:"include",method:"GET"});if(!t.ok){S("Failed to fetch product"),console.error("ProductEditor: ",`failed to fetch, ${t}`);return}let a=await t.json();if(a.c){S("Failed to fetch product"),console.error("ProductEditor: ",a);return}let r=n.Product.getFilled(a.d),i=await r.fetchAttachment();h(r.name),_(r.description),y(r.price.toString()),x(r.category_id),i&&I(i.getImages().map(e=>e.getURL())),w(!1)})()},[t]),(0,i.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/categories/index.php");if(!e.ok)throw Error("Failed to fetch categories");let t=await e.json();P(t.d||[])}catch(e){console.error("Error fetching categories:",e)}})()},[]);let C=async a=>{a.preventDefault(),w(!0),S("");try{let a=null;if(k.length>0){let e=new FormData,t=[];k.forEach((a,r)=>{e.append(`image${r}`,a),t.push({file_id:r+1,size:a.size,type:a.type})}),e.append("files",JSON.stringify(t)),e.append("file_count",t.length.toString());let r=await fetch("/api/attachments/index.php",{method:"POST",credentials:"include",body:e});if(!r.ok)throw Error("Failed to upload images");let i=await r.json();a=i.d.attachment_id,i.d.files.forEach(e=>{(async()=>{console.log(k);let t=await k[e.file_id-1].arrayBuffer();await fetch("/api/attachments/image.php?id="+e.id,{method:"PUT",credentials:"include",body:t})})()}),console.log(i)}let r={name:f,description:g,price:v,stock:"1",category_id:E,attachment_id:a,id:e},i=new FormData;if(i.append("name",r.name),i.append("description",r.description),i.append("price",r.price),i.append("stock",r.stock),i.append("category_id",r.category_id+""),i.append("attachment_id",r.attachment_id+""),!(await fetch("/api/products/index.php",{method:"create"==t?"POST":"PUT",credentials:"include",body:"create"==t?i:JSON.stringify(r)})).ok)throw Error("Failed to create product");S("Product created successfully!"),h(""),_(""),y(""),x(null),U([]),I([])}catch(e){console.error("Error creating product:",e),S(`Error: ${e instanceof Error?e.message:"Unknown error"}`)}finally{await (0,m.mutate)("/products/index.php"),w(!1)}};return(0,r.jsxs)("div",{className:[s.poppins.className,d.default.container].join(" "),children:[(0,r.jsx)("h1",{className:d.default.title,children:"Create New Product"}),(0,r.jsx)(l.Card,{children:(0,r.jsxs)("form",{onSubmit:C,className:d.default.form,children:[(0,r.jsxs)("div",{className:d.default.formGroup,children:[(0,r.jsx)("label",{className:d.default.label,children:"Product Images (Up to 4)"}),(0,r.jsxs)("div",{className:d.default.imageSelector,children:[(0,r.jsx)("div",{className:d.default.imagePreviewGrid,children:F.length>0?F.map((e,t)=>(0,r.jsx)("div",{className:d.default.imagePreview,children:(0,r.jsx)(o.default,{src:e,alt:`Product preview ${t+1}`,width:200,height:200,style:{objectFit:"cover"}})},t)):(0,r.jsx)("div",{className:d.default.imagePreview,children:(0,r.jsx)("div",{className:d.default.placeholderImage,children:(0,r.jsx)("span",{children:"No images selected"})})})}),(0,r.jsxs)("div",{className:d.default.fileInputContainer,children:[(0,r.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{if(e.target.files&&e.target.files.length>0){let t=Array.from(e.target.files).slice(0,4);U(t);let a=[];t.forEach(e=>{let r=new FileReader;r.onloadend=()=>{a.push(r.result),a.length===t.length&&I(a)},r.readAsDataURL(e)})}},className:d.default.fileInput}),(0,r.jsx)("p",{className:d.default.helperText,children:k.length>0?`${k.length} ${1===k.length?"image":"images"} selected (max 4)`:"Select up to 4 images"})]})]})]}),(0,r.jsxs)("div",{className:d.default.formGroup,children:[(0,r.jsx)("label",{htmlFor:"name",className:d.default.label,children:"Product Name"}),(0,r.jsx)("input",{id:"name",type:"text",value:f,onChange:e=>h(e.target.value),required:!0,className:d.default.input})]}),(0,r.jsxs)("div",{className:d.default.formGroup,children:[(0,r.jsx)("label",{htmlFor:"description",className:d.default.label,children:"Product Description"}),(0,r.jsx)("textarea",{id:"description",value:g,onChange:e=>_(e.target.value),required:!0,className:d.default.textarea,rows:5})]}),(0,r.jsxs)("div",{className:d.default.formGroup,children:[(0,r.jsx)("label",{htmlFor:"price",className:d.default.label,children:"Price"}),(0,r.jsx)("input",{id:"price",type:"number",step:"0.01",value:v,onChange:e=>y(e.target.value),required:!0,className:d.default.input})]}),(0,r.jsxs)("div",{className:d.default.formGroup,children:[(0,r.jsx)("label",{htmlFor:"category",className:d.default.label,children:"Category"}),(0,r.jsxs)("select",{id:"category",value:E||"",onChange:e=>x(e.target.value?parseInt(e.target.value):null),className:d.default.select,children:[(0,r.jsx)("option",{value:"",children:"Select a category"}),j.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsx)("div",{className:d.default.formGroup,children:(0,r.jsx)("button",{type:"submit",className:d.default.submitButton,disabled:b,children:b?"Fetching...":"Submit"})}),N&&(0,r.jsx)("div",{className:d.default.message,children:N})]})})]})}}}]);

//# sourceMappingURL=48ef1cd8a0ebadfd.js.map