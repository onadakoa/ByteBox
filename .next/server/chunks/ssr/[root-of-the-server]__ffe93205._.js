module.exports={80278:a=>{var{g:b,__dirname:c}=a;a.v({className:"poppins_9ac3ec3-module__ogIsha__className"})},79916:a=>{"use strict";var{g:b,__dirname:c}=a;{a.s({default:()=>c});var d=a.i(80278);let b={className:d.default.className,style:{fontFamily:"'Poppins', sans-serif",fontStyle:"normal"}};null!=d.default.variable&&(b.variable=d.default.variable);let c=b}},51480:a=>{var{g:b,__dirname:c}=a;a.v({className:"roboto_d5b2c989-module__7PeVaG__className"})},87570:a=>{"use strict";var{g:b,__dirname:c}=a;{a.s({default:()=>c});var d=a.i(51480);let b={className:d.default.className,style:{fontFamily:"'Roboto', sans-serif",fontStyle:"normal"}};null!=d.default.variable&&(b.variable=d.default.variable);let c=b}},68953:a=>{"use strict";var{g:b,__dirname:c}=a;a.s({}),a.i(79916),a.i(87570)},20736:a=>{"use strict";var{g:b,__dirname:c}=a;a.s({}),a.i(79916),a.i(87570),a.i(68953)},25098:a=>{"use strict";var{g:b,__dirname:c}=a;a.s({poppins:()=>d.default});var d=a.i(79916)},53235:a=>{"use strict";var{g:b,__dirname:c}=a;a.s({mutate:()=>d.j});var d=a.i(80661)},63156:a=>{"use strict";var{g:b,__dirname:c}=a;{a.s({Product:()=>b});var d=a.i(717),e=a.i(33459);class b{product_id=0;attachment_id=null;category_id=null;author_id=0;name="";description="";price=0;stock=0;fill(a){Object.assign(this,a)}static getFilled(a){let c=new b;return c.fill(a),c}getCategory(){return this.category_id?d.Category.getById(this.category_id):null}fetchAttachment(){return this.attachment_id?e.Attachment.fetchById(this.attachment_id):null}}}},717:a=>{"use strict";var{g:b,__dirname:c}=a;{a.s({Category:()=>b});var d=a.i(38072);class b{alias=[];id=0;name="";fill(a){Object.assign(this,a)}static getFilled(a){let c=new b;return c.fill(a),c}static async getById(a){let c=await fetch("/api/categories/index.php?id="+a),e=null;try{e=await c.json()}catch(a){console.error(`Category ERROR: ${a}`)}if(!c.ok)throw console.error(`Category ERROR: ${e}`),new d.JsonError(c.status,e);return b.getFilled(e?.d)}}}},91655:function(a){var{g:b,__dirname:c,m:d,e:e}=a;{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f={default:function(){return j},getImageProps:function(){return h}};for(var g in f)Object.defineProperty(e,g,{enumerable:!0,get:f[g]});let b=a.r(95658),c=a.r(20835),d=a.r(99705),i=b._(a.r(27073));function h(a){let{props:b}=(0,c.getImgProps)(a,{defaultLoader:i.default,imgConf:JSON.parse('{"deviceSizes":[640,750,828,1080,1200,1920,2048,3840],"imageSizes":[16,32,48,64,96,128,256,384],"path":"/_next/image","loader":"default","dangerouslyAllowSVG":false,"unoptimized":true}')});for(let[a,c]of Object.entries(b))void 0===c&&delete b[a];return{props:b}}let j=d.Image}},65171:function(a){var{g:b,__dirname:c,m:d,e:e}=a;d.exports=a.r(91655)},33459:a=>{"use strict";var{g:b,__dirname:c}=a;{a.s({ApiImage:()=>c,Attachment:()=>b});var d=a.i(38072);class b{attachment_id=0;author_id=0;creation_date=0;images=[];fill(a){Object.assign(this,a)}getImages(){return this.images.map(a=>c.getFilled(a))}static getFilled(a){let c=new b;return c.fill(a),c}static async fetchById(a){try{let c=await fetch("/api/attachments/index.php?id="+a),e=await c.json();if(!c.ok)throw new d.JsonError(c.status,e);return b.getFilled(e?.d)}catch(a){throw console.error(`Attachment ERROR: ${a}`),a}}}class c{id=0;size=0;type="";fill(a){Object.assign(this,a)}static getFilled(a){let b=new c;return b.fill(a),b}getURL(){return"/api/attachments/image.php?id="+this.id}}}},97731:a=>{var{g:b,__dirname:c}=a;a.v({container:"Card-module__pmewmq__container"})},78858:a=>{"use strict";var{g:b,__dirname:c}=a;a.s({Card:()=>f});var d=a.i(74420),e=a.i(97731);function f(a){let b={padding:a.padding};return(0,d.jsx)("div",{className:e.default.container,style:b,children:a.children})}},60863:a=>{var{g:b,__dirname:c}=a;a.v({container:"ProductEditor-module__nEkUua__container",error:"ProductEditor-module__nEkUua__error",fileInput:"ProductEditor-module__nEkUua__fileInput",fileInputContainer:"ProductEditor-module__nEkUua__fileInputContainer",form:"ProductEditor-module__nEkUua__form",formGroup:"ProductEditor-module__nEkUua__formGroup",helperText:"ProductEditor-module__nEkUua__helperText",imagePreview:"ProductEditor-module__nEkUua__imagePreview",imagePreviewGrid:"ProductEditor-module__nEkUua__imagePreviewGrid",imageSelector:"ProductEditor-module__nEkUua__imageSelector",input:"ProductEditor-module__nEkUua__input",label:"ProductEditor-module__nEkUua__label",message:"ProductEditor-module__nEkUua__message",placeholderImage:"ProductEditor-module__nEkUua__placeholderImage",select:"ProductEditor-module__nEkUua__select",submitButton:"ProductEditor-module__nEkUua__submitButton",textarea:"ProductEditor-module__nEkUua__textarea",title:"ProductEditor-module__nEkUua__title"})},33500:a=>{"use strict";var{g:b,__dirname:c}=a;a.s({default:()=>n});var d=a.i(74420),e=a.i(22851),f=a.i(78858);a.i(20736);var g=a.i(25098),h=a.i(60863),i=a.i(65171),j=a.i(18656),k=a.i(63156),l=a.i(81658),m=a.i(53235);function n(){let a=(0,j.useSearchParams)().get("id"),[b,c]=(0,e.useState)(a?"edit":"create"),{user:n}=(0,l.default)(),[o,p]=(0,e.useState)(""),[q,r]=(0,e.useState)(""),[s,t]=(0,e.useState)(""),[u,v]=(0,e.useState)(null),[w,x]=(0,e.useState)([]),[y,z]=(0,e.useState)(!1),[A,B]=(0,e.useState)(""),[C,D]=(0,e.useState)([]),[E,F]=(0,e.useState)([]);(0,e.useEffect)(()=>{"edit"==b&&(async()=>{z(!0);let b=await fetch("/api/products/index.php?id="+a,{credentials:"include",method:"GET"});if(!b.ok){B("Failed to fetch product"),console.error("ProductEditor: ",`failed to fetch, ${b}`);return}let c=await b.json();if(c.c){B("Failed to fetch product"),console.error("ProductEditor: ",c);return}let d=k.Product.getFilled(c.d),e=await d.fetchAttachment();p(d.name),r(d.description),t(d.price.toString()),v(d.category_id),e&&F(e.getImages().map(a=>a.getURL())),z(!1)})()},[b]),(0,e.useEffect)(()=>{(async()=>{try{let a=await fetch("/api/categories/index.php");if(!a.ok)throw Error("Failed to fetch categories");let b=await a.json();x(b.d||[])}catch(a){console.error("Error fetching categories:",a)}})()},[]);let G=async c=>{c.preventDefault(),z(!0),B("");try{let c=null;if(C.length>0){let a=new FormData,b=[];C.forEach((c,d)=>{a.append(`image${d}`,c),b.push({file_id:d+1,size:c.size,type:c.type})}),a.append("files",JSON.stringify(b)),a.append("file_count",b.length.toString());let d=await fetch("/api/attachments/index.php",{method:"POST",credentials:"include",body:a});if(!d.ok)throw Error("Failed to upload images");let e=await d.json();c=e.d.attachment_id,e.d.files.forEach(a=>{(async()=>{console.log(C);let b=await C[a.file_id-1].arrayBuffer();await fetch("/api/attachments/image.php?id="+a.id,{method:"PUT",credentials:"include",body:b})})()}),console.log(e)}let d={name:o,description:q,price:s,stock:"1",category_id:u,attachment_id:c,id:a},e=new FormData;if(e.append("name",d.name),e.append("description",d.description),e.append("price",d.price),e.append("stock",d.stock),e.append("category_id",d.category_id+""),e.append("attachment_id",d.attachment_id+""),!(await fetch("/api/products/index.php",{method:"create"==b?"POST":"PUT",credentials:"include",body:"create"==b?e:JSON.stringify(d)})).ok)throw Error("Failed to create product");B("Product created successfully!"),p(""),r(""),t(""),v(null),D([]),F([])}catch(a){console.error("Error creating product:",a),B(`Error: ${a instanceof Error?a.message:"Unknown error"}`)}finally{await (0,m.mutate)("/products/index.php"),z(!1)}};return(0,d.jsxs)("div",{className:[g.poppins.className,h.default.container].join(" "),children:[(0,d.jsx)("h1",{className:h.default.title,children:"Create New Product"}),(0,d.jsx)(f.Card,{children:(0,d.jsxs)("form",{onSubmit:G,className:h.default.form,children:[(0,d.jsxs)("div",{className:h.default.formGroup,children:[(0,d.jsx)("label",{className:h.default.label,children:"Product Images (Up to 4)"}),(0,d.jsxs)("div",{className:h.default.imageSelector,children:[(0,d.jsx)("div",{className:h.default.imagePreviewGrid,children:E.length>0?E.map((a,b)=>(0,d.jsx)("div",{className:h.default.imagePreview,children:(0,d.jsx)(i.default,{src:a,alt:`Product preview ${b+1}`,width:200,height:200,style:{objectFit:"cover"}})},b)):(0,d.jsx)("div",{className:h.default.imagePreview,children:(0,d.jsx)("div",{className:h.default.placeholderImage,children:(0,d.jsx)("span",{children:"No images selected"})})})}),(0,d.jsxs)("div",{className:h.default.fileInputContainer,children:[(0,d.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:a=>{if(a.target.files&&a.target.files.length>0){let b=Array.from(a.target.files).slice(0,4);D(b);let c=[];b.forEach(a=>{let d=new FileReader;d.onloadend=()=>{c.push(d.result),c.length===b.length&&F(c)},d.readAsDataURL(a)})}},className:h.default.fileInput}),(0,d.jsx)("p",{className:h.default.helperText,children:C.length>0?`${C.length} ${1===C.length?"image":"images"} selected (max 4)`:"Select up to 4 images"})]})]})]}),(0,d.jsxs)("div",{className:h.default.formGroup,children:[(0,d.jsx)("label",{htmlFor:"name",className:h.default.label,children:"Product Name"}),(0,d.jsx)("input",{id:"name",type:"text",value:o,onChange:a=>p(a.target.value),required:!0,className:h.default.input})]}),(0,d.jsxs)("div",{className:h.default.formGroup,children:[(0,d.jsx)("label",{htmlFor:"description",className:h.default.label,children:"Product Description"}),(0,d.jsx)("textarea",{id:"description",value:q,onChange:a=>r(a.target.value),required:!0,className:h.default.textarea,rows:5})]}),(0,d.jsxs)("div",{className:h.default.formGroup,children:[(0,d.jsx)("label",{htmlFor:"price",className:h.default.label,children:"Price"}),(0,d.jsx)("input",{id:"price",type:"number",step:"0.01",value:s,onChange:a=>t(a.target.value),required:!0,className:h.default.input})]}),(0,d.jsxs)("div",{className:h.default.formGroup,children:[(0,d.jsx)("label",{htmlFor:"category",className:h.default.label,children:"Category"}),(0,d.jsxs)("select",{id:"category",value:u||"",onChange:a=>v(a.target.value?parseInt(a.target.value):null),className:h.default.select,children:[(0,d.jsx)("option",{value:"",children:"Select a category"}),w.map(a=>(0,d.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),(0,d.jsx)("div",{className:h.default.formGroup,children:(0,d.jsx)("button",{type:"submit",className:h.default.submitButton,disabled:y,children:y?"Fetching...":"Submit"})}),A&&(0,d.jsx)("div",{className:h.default.message,children:A})]})})]})}}};

//# sourceMappingURL=%5Broot-of-the-server%5D__ffe93205._.js.map